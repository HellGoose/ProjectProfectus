<% first = (page.to_i - 1) * postsPerPage.to_i %>
<% last = (comments.size() - first)%>
<% if last <= 0 %>
	<% last = 0 %>
<% end %>

<% comments.order('voteCount DESC').last(last).first(postsPerPage.to_i).each do |p| %>
	<div class="row pushed"> <!-- POST -->
<!-- 		<div class="col-xs-1 vote-container">
			<% userVote = p.votes.find_by(user_id: session[:user_id], post_id: p.id)

			opacity = 1
			if !session[:user_id]
				opacity = 0.5
			end %>

			<button id=<%= p.id.to_s %> class="row-fluid glyphicon glyphicon-menu-up post_up_vote" aria-hidden="true"	style="opacity:<%= opacity %>" 
				<% if !session[:user_id] or (userVote != nil and !userVote.isDownvote)%>
					disabled
				<%end%>>
			</button>

			<p class="row text-center"><span id=<%= "post_votes_" + p.id.to_s %>><%= p.voteCount %></span></p>

			<button id=<%=  p.id.to_s %> class="row-fluid glyphicon glyphicon-menu-down post_down_vote" aria-hidden="true" style="opacity:<%= opacity %>" 
				<% if !session[:user_id] or (userVote != nil and userVote.isDownvote)%>
					disabled
				<%end%>>
			</button>
		</div> -->
		<div  class="topic-<%= @topic_counter %>-child container-fluid post-background" style="padding-right: 0;">
			<div class="row">
				<div class="col-xs-1 post-user-img">
					<img class="img-circle text-center" style="margin-left:auto;margin-right:auto;" src=<%=getFacebookPicURL(p.user)%>>
				</div>
				<div class="col-xs-11" style="padding-right: 0;">
					<div class="row">
						<h4 class="col-xs-9 post-user"><%= User.find(p.user_id).name%></h4>
						<div class="col-xs-3" style="padding: 0;">
							<small class="col-xs-8 post-user-date text-right"><%=time_ago_in_words(p.created_at).gsub('about','')%> ago.</small>
							<% if p.user_id == session[:user_id] || isAdmin %>
								<div class="col-xs-4 dropdown text-right" style="padding-right: 0;">
							    <i class="btn btn-default fa fa-ellipsis-v" data-toggle="dropdown"></i>
								  <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="dLabel">
										<li><%= link_to 'Edit', edit_post_path(p)%></li>
										<li><%= link_to 'Delete', p, method: :delete, data: {confirm: "Are you sure?"} %></li>
									</ul>
								</div>
							<% end %>
						</div>
					</div>
					<p class="row content"><%= p.content %></p>
				</div>
			</div>
			<div class="row post-comment-options">
				<% if session[:user_id] %>
					<a class="col-xs-1 btn pull-right answer" id="<%= p.id.to_s %>">Reply</a>
				<% end %>
			</div>
		</div>
		<!-- <hr style="width:100%;"> -->
		

		<div class="answer_div" id="<%= "answer" + p.id.to_s %>"></div>

		<div class="row" id="comments">
			<%= render partial: 'posts/comments', locals: { page: 1, postsPerPage: postsPerPage, comments: p.comments } %>
		</div>

		<div class="data" id="<%= p.id.to_s %>" data-page='1' data-size=<%= p.comments.size %>></div>

		<% if p.comments.size > postsPerPage.to_i %>
			<div class="text-center">
				<a class="btn btn-default more_comments" id="<%= p.id.to_s %>">Show More</a>
			</div>
		<% end %>
	</div>
<% end %>